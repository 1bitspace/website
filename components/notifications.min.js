/*babeled & compressed*/
"use strict";function _instanceof(t,i){return null!=i&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](t):t instanceof i}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,i){if(t){if("string"==typeof t)return _arrayLikeToArray(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,i):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}function _classCallCheck(t,i){if(!_instanceof(t,i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,i,e){return i&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e),t}var App_notifications=function(){function t(i){_classCallCheck(this,t);var e=this;this.user=i.user,this.token=i.token,this.limit=0,this.buttonLoading=document.querySelector(".button-notifications-navbar"),this.container=turpial.find("container-notifications-list"),this.bellElement=turpial.find("notification-bell-button"),this.loop_time=5e3,this.is_loading_more=!1,this.websiteActive=!0,this.AjaxUpdateStarted=!1,this.ajaxLoading=!1,this.readed=!0,this.notifications=[],this.position=1,this.bellsElements=[],this.lastNotificationID="-none-",this.init(this.position),this.bellElement.addEventListener("click",function(){e.animateBell("stop"),e.setAsRead()}),this.buttonLoading.addEventListener("click",function(){e.is_loading(!0),e.loadMore()}),window.addEventListener("focus",function(){e.websiteActive=!0}),window.addEventListener("blur",function(){e.websiteActive=!1})}return _createClass(t,[{key:"is_loading",value:function(t){t=turpial.un(t,!0);var i=this.buttonLoading;!0===t?coreApp.form.statusButton(i,"disabled"):coreApp.form.statusButton(i,"enabled")}},{key:"statuses",value:function(t){return"success"===(t=t||"success")?["has-background-success","check-circle"]:"warning"===t?["has-background-warning","exclamation"]:"error"===t?["has-background-danger","times"]:["has-background-info","info"]}},{key:"notificationTemplate",value:function(t,i){var e=turpial.find("ntf-"+t.id),n=turpial.find("ntficon-"+t.id);null!==e&&null!==n&&(e.remove(),n.remove());var a=this.statuses(t.s),o="";return o+=turpial.el("div",{class:"column is-2 is-flex-centered is-grid",id:"ntficon-"+t.id},[turpial.el("p",{class:"".concat(a[0]," has-text-centered shadow-element has-text-white is-size-4"),style:"border-radius:6px;"},[turpial.el("i",{class:"fas fa-".concat(a[1])})])]),o+=turpial.el("div",{class:"column is-10 is-flex-centered is-grid",id:"ntf-"+t.id},[turpial.el("p",{class:"bolder"},coreApp.date.onlydate(t.t)),turpial.el("p",t.c)])}},{key:"animateBell",value:function(t){t=turpial.un(t,"start"),this.bellsElements=_toConsumableArray(document.querySelectorAll(".nt-circle, .nt-bell")),this.bellsElements.forEach(function(i){"start"===t?(i.classList.add("animated"),i.classList.add("has-text-warning")):(i.classList.remove("animated"),i.classList.remove("has-text-warning"))})}},{key:"AjaxUpdate",value:function(){var t=this;if(!0!==this.AjaxUpdateStarted){this.AjaxUpdateStarted=!0;setInterval(function(){!0!==t.is_loading_more&&!1!==t.websiteActive&&!0!==t.ajaxLoading&&(this.ajaxLoading=!0,t.init(0,{user:t.user,token:t.token,action:"update",lastNotificationID:t.lastNotificationID}))},t.loop_time)}}},{key:"loadMore",value:function(){this.position>=this.limit?this.onLimit():!0!==this.is_loading_more&&(this.is_loading_more=!0,this.position=this.position+1,this.init(this.position,{user:this.user,token:this.token,action:"loadMore"}))}},{key:"onLimit",value:function(){hideElement(this.buttonLoading)}},{key:"setAsRead",value:function(){!0!==this.readed&&this.init(0,{user:this.user,token:this.token,action:"setAsRead"})}},{key:"nodata",value:function(){this.readed=!0,this.animateBell("stop"),hideElement(this.buttonLoading),this.position=0,turpial.insert(this.container,turpial.el("div",{class:"columns is-multiline"},[turpial.el("div",{class:"column is-12"},[turpial.el("h4",{class:"has-text-centered",style:"margin: 45px 0;"},[turpial.el("span",{class:"has-text-dark sh-spacing"},"YOU DON'T HAVE NOTIFICATIONS")])])]))}},{key:"init",value:function(t,i){var e=this;i=i||{},turpial.mdb.paginate.create({url:"pagination/user-notifications",itemName:"t",dataType:"ARRAY",PerPage:"20",nextButton:"Next",backButton:"Previus",buttonClasses:"button has-background-alt-5 bold has-text-white",buttonSelectedClasses:"button is-primary has-text-white bold",disabledStyles:"background-color:white;color:var(--color-alt-4) !important;",position:t||1,filters:[],sortby:i.sortby||"desc",searchFor:!1,fromDate:!1,topbar:!1,public_key:this.user.api_public_key,token:coreApp.d(this.token),action:i.action||"no-action",last_notification:i.lastNotificationID,untilDate:!1,itemNameForDates:"t",navigationContainer:!1,ready:function(t){if(e.ajaxLoading=!1,"no-action"===i.action&&e.is_loading(!1),e.limit=t.limit,e.notifications=t.data,e.readed=t.readed,e.callback=t.callback,e.is_loading(!1),!1===e.readed&&(e.animateBell(),showElement(e.buttonLoading,"inline-flex"),e.position=0),null!==t.data)if(t.data.length<1)e.nodata();else{e.lastNotificationID=e.notifications[0].id,e.AjaxUpdate();var n="";e.notifications.forEach(function(t){n+=e.notificationTemplate(t,i.action)}),n=turpial.el("div",{class:"columns is-multiline is-mobile"},n),"loadMore"===e.callback?(e.is_loading_more=!1,turpial.mount(e.container,n)):turpial.insert(e.container,n)}else e.nodata()},onerror:function(t){e.readed=t.readed,t.callback}})}}]),t}(),app_notifications=new App_notifications({user:coreApp.json.parse(coreApp.d(u)),token:token});
